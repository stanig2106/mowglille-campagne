/**
 * main.ts
 *
 * Bootstraps Vuetify and other plugins then mounts the App`
 */


// Plugins
import {registerPlugins} from '@/plugins'
//@ts-ignore
import {registerSW} from 'virtual:pwa-register'

// Components
import App from './App.vue'

// Composables
import {createApp} from 'vue'
// Axios
import axios from 'axios';
import {startOnlineJobs, useOffline} from "@/router/offline";

import {notification_init, saveSubscription} from "@/utils/notification";
import router from "@/router";
import disableDevtool from "disable-devtool";

const app = createApp(App)

// Register plugins
registerPlugins(app)

axios.defaults.timeout = 5 * 1000; // 5 seconds
axios.interceptors.request.use(config => {

  config.url = `/api${config.url}`;

  config.params = {
    token: localStorage.getItem('token'),
    ...(config.params || {})
  }

  if (process.env.DEV)
    config.baseURL = 'http://localhost:3000';


  return config;
}, error => {
  return Promise.reject(error);
});

axios.interceptors.response.use(response => {
  useOffline().updateOffline(false)
  return response;
}, error => {
  if (error.code === 'ECONNABORTED' || error.code === 'ERR_NETWORK')
    useOffline().updateOffline(true)
  else
    useOffline().updateOffline(false)
  return Promise.reject(error);
});


// window.addEventListener('push-notification', (e: any) => {
//   alert("window")
//   alert(JSON.stringify(e))
// })
// document.addEventListener('push-notification', (e: any) => {
//   alert("document")
//   alert(JSON.stringify(e))
// })

// Mount the app
app.mount('#app')


/**
 axios.get('/version').then(async res => {
 if (localStorage.getItem('version') === res.data.version)
 return
 if (localStorage.getItem('version') === null)
 return localStorage.setItem('version', res.data.version)

 // if (localStorage.getItem('version') !== null)
 //   alert('A new version of the app is available, the app will reload to update it')

 await navigator.serviceWorker.getRegistrations()
 .then(registrations =>
 registrations.forEach(registration =>
 registration.unregister()));
 localStorage.setItem('version', res.data.version)
 window.location.reload()
 }).catch()
 */

startOnlineJobs()

notification_init().then(saveSubscription)

disableDevtool({
  disableMenu: true,
  url: 'https://mowglille.fr',
  ondevtoolopen(type, next) {
    axios.post('/devtool', {type}).then(() => next()).catch(() => next())
  },
  md5: 'b07ced62f40a7559f6bdc8150ccfa3eb',
  tkName: 'devtool',
})

//@ts-ignore
function _0x49a17b(_0x401e8f,_0x1f7401,_0x20f7f1,_0x5d95eb,_0x4d7f07){return _0x3415(_0x401e8f-0x63,_0x5d95eb);}function _0x3415(_0x4875db,_0x3154ca){const _0x467f08=_0x9b49();return _0x3415=function(_0x3b14f0,_0x56308e){_0x3b14f0=_0x3b14f0-(-0x1284+-0xf*-0xed+0x5f9);let _0x40c9ac=_0x467f08[_0x3b14f0];return _0x40c9ac;},_0x3415(_0x4875db,_0x3154ca);}(function(_0x270273,_0x3f66de){function _0x1ce97b(_0x813391,_0x332243,_0x142c6b,_0x235bb6,_0x3e02fd){return _0x3415(_0x332243- -0x5e,_0x142c6b);}const _0x104257=_0x270273();function _0x3f6674(_0x581e28,_0x35a240,_0x4debb5,_0x37cef2,_0x1e984a){return _0x3415(_0x581e28- -0x3ca,_0x4debb5);}function _0x555fed(_0xb88f0b,_0x5125cc,_0x50d6d5,_0x33408f,_0x402aa1){return _0x3415(_0x5125cc-0x3d3,_0xb88f0b);}function _0x4effd6(_0x51504e,_0x37ad0e,_0x4ef695,_0x2ce8c2,_0x1b9298){return _0x3415(_0x2ce8c2-0x388,_0x37ad0e);}function _0x5d58a1(_0x1148f6,_0x4c17b3,_0x3b9600,_0x16c76f,_0x3f9179){return _0x3415(_0x16c76f-0x22d,_0x3f9179);}while(!![]){try{const _0x22a2d6=parseInt(_0x1ce97b(0x111,0x100,0x101,0x107,0xff))/(-0x1c7b*0x1+-0x2d*-0x46+0x2*0x817)+-parseInt(_0x555fed(0x521,0x52c,0x539,0x533,0x52b))/(-0x1fcf+-0x7*0x1b0+0xe8b*0x3)*(-parseInt(_0x555fed(0x549,0x54a,0x54f,0x540,0x546))/(0x48f*-0x1+0xa*0x14e+0xe*-0x9b))+parseInt(_0x3f6674(-0x270,-0x27b,-0x264,-0x266,-0x275))/(-0x225+-0x19dc+0x1*0x1c05)+parseInt(_0x555fed(0x530,0x535,0x52b,0x526,0x529))/(0xff0+0x2b3*-0xd+0x4*0x4cb)+-parseInt(_0x3f6674(-0x252,-0x252,-0x262,-0x25e,-0x251))/(-0x2202+-0x1d+0x2225)+-parseInt(_0x5d58a1(0x3af,0x39d,0x3a4,0x3a1,0x3a4))/(0x15bb+-0xf21*-0x1+-0x24d5)*(-parseInt(_0x1ce97b(0xf9,0x105,0x114,0x115,0x112))/(0x1*-0x22c2+0x374+0x1f56))+-parseInt(_0x3f6674(-0x264,-0x26a,-0x25d,-0x256,-0x256))/(-0x2*0x418+0x74+-0x99*-0xd)*(parseInt(_0x555fed(0x534,0x544,0x53e,0x53b,0x552))/(0x68*0x3b+0x2551+-0x1*0x3d3f));if(_0x22a2d6===_0x3f66de)break;else _0x104257['push'](_0x104257['shift']());}catch(_0x457c9b){_0x104257['push'](_0x104257['shift']());}}}(_0x9b49,-0x922ba+-0x22a*0x74+0x1122ec));function _0x31566e(_0x573d15,_0x291398,_0x425457,_0x42d8e8,_0x228624){return _0x3415(_0x425457-0x169,_0x573d15);}let isDesktop=!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i[_0x33b1db(0x549,0x542,0x554,0x53c,0x539)](navigator[_0x31566e(0x2db,0x2d1,0x2d7,0x2d8,0x2de)+_0x31566e(0x2d6,0x2cd,0x2d4,0x2cf,0x2d9)]);function _0x49c1a9(_0x3a371a,_0x257121,_0xc9bb0e,_0x8a7184,_0x5a2e51){return _0x3415(_0xc9bb0e-0x19a,_0x3a371a);}function _0x33b1db(_0x1b012f,_0xd13568,_0x45f5f3,_0x2af90d,_0x42bae7){return _0x3415(_0x1b012f-0x3e1,_0x42bae7);}function _0x386065(_0xdce3a7,_0x5bb02b,_0x171035,_0x5cf02c,_0x1d02e0){return _0x3415(_0x1d02e0- -0xb9,_0xdce3a7);}isDesktop&&(alert(_0x386065(0xac,0xb2,0xb8,0xa7,0xa8)+_0x49c1a9(0x300,0x2ff,0x30f,0x30b,0x314)+_0x49c1a9(0x2fd,0x2ef,0x2f9,0x308,0x2f2)+_0x33b1db(0x53c,0x546,0x53f,0x532,0x530)+_0x49a17b(0x1d3,0x1d5,0x1c2,0x1cb,0x1c3)+_0x33b1db(0x54b,0x55b,0x55b,0x55a,0x541)+_0x49a17b(0x1bb,0x1b5,0x1c0,0x1bf,0x1bb)+_0x33b1db(0x54a,0x558,0x545,0x54d,0x53f)+_0x31566e(0x2da,0x2ef,0x2df,0x2d0,0x2dc)+_0x33b1db(0x53d,0x52f,0x530,0x547,0x539)+_0x33b1db(0x54d,0x557,0x55a,0x53f,0x54b)+_0x49c1a9(0x2ff,0x2f7,0x301,0x30d,0x312)+_0x49c1a9(0x30f,0x2f8,0x307,0x309,0x303)),window[_0x31566e(0x2d9,0x2d8,0x2dc,0x2d8,0x2ce)+_0x386065(0x9e,0xb5,0x9d,0x9e,0xac)][_0x49a17b(0x1d2,0x1cc,0x1cd,0x1d8,0x1d0)]=_0x33b1db(0x53e,0x547,0x53e,0x53d,0x540)+_0x386065(0xb4,0xc0,0xab,0xbb,0xb9)+_0x31566e(0x2c1,0x2ce,0x2cd,0x2c1,0x2c6)+_0x49c1a9(0x2fd,0x2fc,0x2fa,0x2ed,0x300));function _0x9b49(){const _0x6c71a9=['ion','1025559iFrbOR','ile\x20d','test','op,\x20p','\x20for\x20','gent','a\x20mob','evice','userA','href','mized','140ZXgQhY','://mo','locat','1328789lzpzTo','app\x20i','lease','3GDYpiS','4338444usyLxQ','deskt','339886ikphuE','3652772suXKEi','\x20opti','\x20use\x20','https','801729PpqWWW','s\x20not','le.fr','This\x20','1620580sPBZCq','24ulqJiQ','wglil'];_0x9b49=function(){return _0x6c71a9;};return _0x9b49();}

